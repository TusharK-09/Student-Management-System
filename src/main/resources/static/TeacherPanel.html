<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Teacher Panel</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="container">
    <h1>Teacher Panel</h1>
    <p><strong>Welcome:</strong> <span id="teacherName"></span></p>

    <!-- Load Students -->
    <button onclick="loadStudents()">Load All Students</button>
    <div id="studentList"></div>

    <!-- Add Notes -->
    <h3>Add Notes</h3>
    <input type="text" id="username" placeholder="Student Username">
    <input type="text" id="notes" placeholder="Notes">
    <button onclick="addNotes()">Add Notes</button>
    <p id="message"></p>

    <!-- Add Student -->
    <h3>Add Student</h3>
    <input type="text" id="stuName" placeholder="Full Name">
    <input type="text" id="stuUsername" placeholder="Username">
    <input type="password" id="stuPassword" placeholder="Password">
    <input type="text" id="stuCourse" placeholder="Course (e.g., Btech CSE)">
    <input type="number" id="stuYear" placeholder="Passing Year">
    <input type="number" step="0.1" id="stuCgpa" placeholder="CGPA">
    <button onclick="addStudent()">Add Student</button>
    <p id="studentMessage"></p>

    <!-- Logout -->
    <button onclick="logout()">Logout</button>
</div>

<script>
    function loadTeacherInfo() {
      const username = sessionStorage.getItem('username');
      if (!username) {
        window.location.href = "login.html";
        return;
      }
      document.getElementById('teacherName').innerText = username;
    }

    async function loadStudents() {
      const response = await fetch('/api/teacher/allStudents');
      const students = await response.json();
      let html = "<ul>";
      students.forEach(s => {
        html += `<li>${s.username} - Notes: ${s.notes || "No notes"}</li>`;
      });
      html += "</ul>";
      document.getElementById('studentList').innerHTML = html;
    }

    async function addNotes() {
      const username = document.getElementById('username').value;
      const notes = document.getElementById('notes').value;

      const response = await fetch('/api/teacher/addNotes', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, notes })
      });

      const result = await response.text();
      document.getElementById('message').innerText = result;
    }

    async function addStudent() {
      const name = document.getElementById('stuName').value;
      const username = document.getElementById('stuUsername').value;
      const password = document.getElementById('stuPassword').value;
      const course = document.getElementById('stuCourse').value;
      const year = parseInt(document.getElementById('stuYear').value);
      const cgpa = parseFloat(document.getElementById('stuCgpa').value);

      const response = await fetch('/api/teacher/addStudent', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name, username, password, role: "STUDENT", course, passingYear: year, cgpa
        })
      });

      const result = await response.text();
      document.getElementById('studentMessage').innerText = result;
    }

    function logout() {
      sessionStorage.clear();
      window.location.href = "LoginPanel.html";
    }

    loadTeacherInfo();
</script>
</body>
</html>
